crystal_doc_search_index_callback({"repository_name":"jwks","body":"# jwks\n\n[![CI](https://github.com/place-labs/jwks/actions/workflows/ci.yml/badge.svg?branch=master)](https://github.com/place-labs/jwks/actions/workflows/ci.yml) [![GitHub release (latest by date)](https://img.shields.io/github/v/release/place-labs/jwks)](https://img.shields.io/github/v/release/place-labs/jwks?style=flat-square)\n\nSimple library that validates JWT against RS256 JWKS URI\n\n## Installation\n\n1. Add the dependency to your `shard.yml`:\n\n   ```yaml\n   dependencies:\n     jwks:\n       github: place-labs/jwks\n   ```\n\n2. Run `shards install`\n\n## Usage\n\n```crystal\nrequire \"jwks\"\n```\n\n## Development\n\n### Docker\n\n```bash\ndocker build . -t jwks && docker run jwks\n```\n\n### Without Docker\n\n- You need to have openssl@1.1.1\n- For MacOS users, if Crystal has not installed this for you\n```bash\nbrew install openssl@1.1.1\n\nshards install\ncrystal spec\ncrystal tool format --check\nbin/ameba\n```\n\n## Contributing\n\n1. Fork it (<https://github.com/dukeraphaelng/jwks/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'feat(jwks.cr): Add some feature'`)\n   - **Git Commit Convention**: This repository follows [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0-beta.2/)/ [the Angular convention](https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#-commit-message-guidelines). The preferred tool of git commit is [commitizen/cz-cli](https://github.com/commitizen/cz-cli).\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Duke Nguyen](https://github.com/dukeraphaelng) - creator and maintainer\n\n## License\n\n- [MIT](LICENSE)","program":{"html_id":"jwks/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"jwks","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"jwks/JW","path":"JW.html","kind":"module","full_name":"JW","name":"JW","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/jwks.cr","line_number":10,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L10"}],"repository_name":"jwks","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"jwks/JW/Public","path":"JW/Public.html","kind":"module","full_name":"JW::Public","name":"Public","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/jwks.cr","line_number":11,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L11"}],"repository_name":"jwks","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"jwks/JW","kind":"module","full_name":"JW","name":"JW"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"jwks/JW/Public/Key","path":"JW/Public/Key.html","kind":"struct","full_name":"JW::Public::Key","name":"Key","abstract":false,"superclass":{"html_id":"jwks/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"jwks/JSON/Serializable/Unmapped","kind":"module","full_name":"JSON::Serializable::Unmapped","name":"Unmapped"},{"html_id":"jwks/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"},{"html_id":"jwks/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"jwks/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"jwks/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/jwks.cr","line_number":12,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L12"}],"repository_name":"jwks","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[{"html_id":"jwks/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"},{"html_id":"jwks/JSON/Serializable/Unmapped","kind":"module","full_name":"JSON::Serializable::Unmapped","name":"Unmapped"}],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"jwks/JW/Public","kind":"module","full_name":"JW::Public","name":"Public"},"doc":null,"summary":null,"class_methods":[{"html_id":"to_pem(jwk:JW::Public::Key):String-class-method","name":"to_pem","doc":null,"summary":null,"abstract":false,"args":[{"name":"jwk","doc":null,"default_value":"","external_name":"jwk","restriction":"JW::Public::Key"}],"args_string":"(jwk : JW::Public::Key) : String","args_html":"(jwk : <a href=\"../../JW/Public/Key.html\">JW::Public::Key</a>) : String","location":{"filename":"src/jwks.cr","line_number":35,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L35"},"def":{"name":"to_pem","args":[{"name":"jwk","doc":null,"default_value":"","external_name":"jwk","restriction":"JW::Public::Key"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"modulus, exponent = [jwk.n, jwk.e].map do |v|\n  bin = Base64.decode(v)\n  OpenSSL::BN.from_bin(bin)\nend\nrsa = LibCrypto.rsa_new\nio = IO::Memory.new\nLibCrypto.rsa_set0_key(rsa, modulus, exponent, nil)\nbio = OpenSSL::GETS_BIO.new(io)\nLibCrypto.pem_write_bio_rsa_pub_key(bio, rsa)\nio.to_s\n"}}],"constructors":[{"html_id":"new(pull:JSON::PullParser)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"pull","doc":null,"default_value":"","external_name":"pull","restriction":"::JSON::PullParser"}],"args_string":"(pull : JSON::PullParser)","args_html":"(pull : JSON::PullParser)","location":{"filename":"src/jwks.cr","line_number":13,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L13"},"def":{"name":"new","args":[{"name":"pull","doc":null,"default_value":"","external_name":"pull","restriction":"::JSON::PullParser"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"new_from_json_pull_parser(pull)"}}],"instance_methods":[{"html_id":"e:String-instance-method","name":"e","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/jwks.cr","line_number":21,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L21"},"def":{"name":"e","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@e"}},{"html_id":"e=(e:String)-instance-method","name":"e=","doc":null,"summary":null,"abstract":false,"args":[{"name":"e","doc":null,"default_value":"","external_name":"e","restriction":"String"}],"args_string":"(e : String)","args_html":"(e : String)","location":{"filename":"src/jwks.cr","line_number":21,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L21"},"def":{"name":"e=","args":[{"name":"e","doc":null,"default_value":"","external_name":"e","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@e = e"}},{"html_id":"kid:String-instance-method","name":"kid","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/jwks.cr","line_number":16,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L16"},"def":{"name":"kid","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@kid"}},{"html_id":"kid=(kid:String)-instance-method","name":"kid=","doc":null,"summary":null,"abstract":false,"args":[{"name":"kid","doc":null,"default_value":"","external_name":"kid","restriction":"String"}],"args_string":"(kid : String)","args_html":"(kid : String)","location":{"filename":"src/jwks.cr","line_number":16,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L16"},"def":{"name":"kid=","args":[{"name":"kid","doc":null,"default_value":"","external_name":"kid","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@kid = kid"}},{"html_id":"kty:Kty-instance-method","name":"kty","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Kty","args_html":" : <a href=\"../../JW/Public/Key/Kty.html\">Kty</a>","location":{"filename":"src/jwks.cr","line_number":17,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L17"},"def":{"name":"kty","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Kty","visibility":"Public","body":"@kty"}},{"html_id":"kty=(kty:Kty)-instance-method","name":"kty=","doc":null,"summary":null,"abstract":false,"args":[{"name":"kty","doc":null,"default_value":"","external_name":"kty","restriction":"Kty"}],"args_string":"(kty : Kty)","args_html":"(kty : <a href=\"../../JW/Public/Key/Kty.html\">Kty</a>)","location":{"filename":"src/jwks.cr","line_number":17,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L17"},"def":{"name":"kty=","args":[{"name":"kty","doc":null,"default_value":"","external_name":"kty","restriction":"Kty"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@kty = kty"}},{"html_id":"n:String-instance-method","name":"n","doc":"RSA - RS256 Algorithm Public Key Props","summary":"<p>RSA - RS256 Algorithm Public Key Props</p>","abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/jwks.cr","line_number":20,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L20"},"def":{"name":"n","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@n"}},{"html_id":"n=(n:String)-instance-method","name":"n=","doc":"RSA - RS256 Algorithm Public Key Props","summary":"<p>RSA - RS256 Algorithm Public Key Props</p>","abstract":false,"args":[{"name":"n","doc":null,"default_value":"","external_name":"n","restriction":"String"}],"args_string":"(n : String)","args_html":"(n : String)","location":{"filename":"src/jwks.cr","line_number":20,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L20"},"def":{"name":"n=","args":[{"name":"n","doc":null,"default_value":"","external_name":"n","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@n = n"}},{"html_id":"to_pem:String-instance-method","name":"to_pem","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/jwks.cr","line_number":31,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L31"},"def":{"name":"to_pem","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"self.class.to_pem(self)"}}],"macros":[],"types":[{"html_id":"jwks/JW/Public/Key/Kty","path":"JW/Public/Key/Kty.html","kind":"enum","full_name":"JW::Public::Key::Kty","name":"Kty","abstract":false,"superclass":null,"ancestors":[{"html_id":"jwks/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"jwks/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"jwks/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"jwks/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/jwks.cr","line_number":25,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L25"}],"repository_name":"jwks","program":false,"enum":true,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"RSA","name":"RSA","value":"0","doc":"Only supports RSA at the moment\nEC","summary":"<p>Only supports RSA at the moment EC</p>"}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"jwks/JW/Public/Key","kind":"struct","full_name":"JW::Public::Key","name":"Key"},"doc":"https://tools.ietf.org/html/rfc7518#section-6.1\nhttps://tools.ietf.org/html/rfc7518#section-7.4.2","summary":"<p>https://tools.ietf.org/html/rfc7518#section-6.1 https://tools.ietf.org/html/rfc7518#section-7.4.2</p>","class_methods":[],"constructors":[],"instance_methods":[{"html_id":"rsa?-instance-method","name":"rsa?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/jwks.cr","line_number":28,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L28"},"def":{"name":"rsa?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == RSA"}}],"macros":[],"types":[]}]},{"html_id":"jwks/JW/Public/KeySets","path":"JW/Public/KeySets.html","kind":"class","full_name":"JW::Public::KeySets","name":"KeySets","abstract":false,"superclass":{"html_id":"jwks/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"jwks/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"jwks/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/jwks.cr","line_number":51,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L51"}],"repository_name":"jwks","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"jwks/JW/Public","kind":"module","full_name":"JW::Public","name":"Public"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"html_id":"new(uri,cache_duration=24.hours)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"uri","doc":null,"default_value":"","external_name":"uri","restriction":""},{"name":"cache_duration","doc":null,"default_value":"24.hours","external_name":"cache_duration","restriction":""}],"args_string":"(uri, cache_duration = 24.hours)","args_html":"(uri, cache_duration = <span class=\"n\">24</span>.hours)","location":{"filename":"src/jwks.cr","line_number":56,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L56"},"def":{"name":"new","args":[{"name":"uri","doc":null,"default_value":"","external_name":"uri","restriction":""},{"name":"cache_duration","doc":null,"default_value":"24.hours","external_name":"cache_duration","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(uri, cache_duration)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"cache_duration:Time::Span-instance-method","name":"cache_duration","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Time::Span","args_html":" : Time::Span","location":{"filename":"src/jwks.cr","line_number":54,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L54"},"def":{"name":"cache_duration","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Time::Span","visibility":"Public","body":"@cache_duration"}},{"html_id":"select(kid:String):Key-instance-method","name":"select","doc":null,"summary":null,"abstract":false,"args":[{"name":"kid","doc":null,"default_value":"","external_name":"kid","restriction":"String"}],"args_string":"(kid : String) : Key","args_html":"(kid : String) : <a href=\"../../JW/Public/Key.html\">Key</a>","location":{"filename":"src/jwks.cr","line_number":67,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L67"},"def":{"name":"select","args":[{"name":"kid","doc":null,"default_value":"","external_name":"kid","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Key","visibility":"Public","body":"SimpleRetry.try_to(max_attempts: 3, retry_on: NilAssertionError, base_interval: 1.milliseconds) do |count|\n  Log.info do\n    \"Retry attempt: #{count}\"\n  end\n  (self.class.new(@uri)).values.not_nil!.find do |__arg0|\n    __arg0.kid == kid\n  end.not_nil!\nend"}},{"html_id":"uri:String-instance-method","name":"uri","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/jwks.cr","line_number":53,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L53"},"def":{"name":"uri","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@uri"}},{"html_id":"values:Array(Key)?-instance-method","name":"values","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Array(Key)?","args_html":" : Array(<a href=\"../../JW/Public/Key.html\">Key</a>)?","location":{"filename":"src/jwks.cr","line_number":52,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L52"},"def":{"name":"values","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(Key) | ::Nil","visibility":"Public","body":"@values"}}],"macros":[],"types":[]}]},{"html_id":"jwks/JW/Token","path":"JW/Token.html","kind":"module","full_name":"JW::Token","name":"Token","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/jwks.cr","line_number":80,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L80"}],"repository_name":"jwks","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"jwks/JW","kind":"module","full_name":"JW","name":"JW"},"doc":null,"summary":null,"class_methods":[{"html_id":"validate_with_jwks_uri(jwt_token:String,jwks_uri:String)-class-method","name":"validate_with_jwks_uri","doc":null,"summary":null,"abstract":false,"args":[{"name":"jwt_token","doc":null,"default_value":"","external_name":"jwt_token","restriction":"String"},{"name":"jwks_uri","doc":null,"default_value":"","external_name":"jwks_uri","restriction":"String"}],"args_string":"(jwt_token : String, jwks_uri : String)","args_html":"(jwt_token : String, jwks_uri : String)","location":{"filename":"src/jwks.cr","line_number":81,"url":"https://github.com/place-labs/jwks/blob/d8545f6bb64a5e0d4e9a670cc4eca5e38ae13e63/src/jwks.cr#L81"},"def":{"name":"validate_with_jwks_uri","args":[{"name":"jwt_token","doc":null,"default_value":"","external_name":"jwt_token","restriction":"String"},{"name":"jwks_uri","doc":null,"default_value":"","external_name":"jwks_uri","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"jwt_header = ::JWT.decode(token: jwt_token, verify: false, validate: false)[1]\nif jwt_header[\"typ\"] == \"JWT\"\nelse\n  raise(ArgumentError.new(\"Typ #{jwt_header[\"typ\"]} of invalid type (should be JWT)\"))\nend\nalgo = ::JWT::Algorithm.parse(jwt_header[\"alg\"].as_s)\nif algo.as?(::JWT::Algorithm::RS256)\nelse\n  raise(ArgumentError.new(\"Alg #{jwt_header[\"alg\"]} not yet supported (only RS256)\"))\nend\njwk = (JW::Public::KeySets.new(jwks_uri)).select(jwt_header[\"kid\"].as_s)\njwt_public_key_pem = jwk.to_pem\n::JWT.decode(token: jwt_token, key: jwt_public_key_pem, algorithm: algo, verify: true, validate: true)\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]}]}})